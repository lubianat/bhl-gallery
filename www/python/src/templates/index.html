{% extends "layout.html" %}

{% block main %}

<main>
    <div class="container py-4">
        <h1 class="text-center mb-4 fancy-style">BHL Image Explorer</h1>

        <form id="filterForm" class="mb-4">
            <div class="row g-3 align-items-center">
                <div class="col-md-4">
                    <label for="taxonSelect" class="form-label">Default taxa:</label>
                    <select id="taxonSelect" class="form-select" required>
                        <option value="">Select a taxon</option>
                        <option value="ALL">All</option>
                        <option value="212">Aves</option>
                        <option value="216">Insecta</option>
                        <option value="131">Amphibia</option>
                        <option value="359">Mammalia</option>
                        <option value="6">Plantae</option>
                        <option value="587">Perciformes</option>
                    </select>
                </div>
                <div class="col-md-4 position-relative">
                    <label for="wikidataAutocomplete" class="form-label">Other taxa:</label>
                    <input type="text" id="wikidataAutocomplete" class="form-control"
                        placeholder="Search taxon (common or scientific names)" autocomplete="off">
                    <div id="wikidataAutocompleteSuggestions" class="autocomplete-suggestions"></div>
                    <div class="invalid-feedback">
                        You’ve typed a name but haven’t selected a suggestion. Please pick one from the list or
                        clear
                        the field.
                    </div>
                </div>
                <div class="col-md-4">
                    <label for="continentSelect" class="form-label">Continent:</label>
                    <select id="continentSelect" class="form-select">
                        <option value="">Any</option>
                        <option value="AFRICA">AFRICA</option>
                        <option value="ANTARCTICA">ANTARCTICA</option>
                        <option value="ASIA">ASIA</option>
                        <option value="OCEANIA">OCEANIA</option>
                        <option value="EUROPE">EUROPE</option>
                        <option value="NORTH_AMERICA">NORTH_AMERICA</option>
                        <option value="SOUTH_AMERICA">SOUTH_AMERICA</option>
                    </select>
                </div>
            </div>
            <div class="row g-3 align-items-center mt-3">
                <div class="col-md-6 d-flex align-items-center">
                    <label class="form-label mb-0 me-3">Data Source:</label>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" id="sourceJson" name="dataSource"
                            value="species-api" checked>
                        <label class="form-check-label" for="sourceJson">/species GBIF API (distribution)</label>
                    </div>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" id="sourceGbif" name="dataSource"
                            value="occurrence-api">
                        <label class="form-check-label" for="sourceGbif">/occurrence API</label>
                    </div>
                </div>
                <div class="col-md-6 text-md-end">
                    <button type="button" id="resetFilter" class="btn btn-secondary">Reset Filters</button>
                </div>

            </div>

        </form>
        <h2 class="fancy-style text-center" id="selectedTaxonName"></h2>
        <div id="taxonInfoAccordion">
            <h2 class="fancy-style" style="cursor: pointer;" onclick="toggleTaxonInfo()">
                Hierarchy & Map <span id="arrow">&#x25B6;</span>
            </h2>

            <div id="taxonInfoContent" style="display: none;">
                <div>
                    <p> Click on a name to search for images about it.</p>
                </div>
                <div class="row mb-4">
                    <div class="col-md-6">
                        <h2 class="text-center fancy-style">Taxonomic Hierarchy</h2>
                        <div id="taxonNavigation"></div>
                    </div>
                    <div class="col-md-6">
                        <h2 class="text-center fancy-style">Global GBIF Occurrences</h2>
                        <div id="distributionMap" style="height: 400px;"></div>
                    </div>
                </div>
            </div>
        </div>

        <h2 class="fancy-style">Gallery</h2>

        <div class="alert alert-light text-center" role="alert" id="loading">
            <span class="fs-5">Loading images...</span>
        </div>
        <div id="imageCounter" class="alert alert-success text-center hidden">
            Images found: <span id="imageCount">0</span>
        </div>
        <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 g-4" id="gallery">
            <!-- Gallery items will be dynamically inserted here -->
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script src="{{ url_for('static', filename='script.js') }}"></script>
</main>

{% endblock %}